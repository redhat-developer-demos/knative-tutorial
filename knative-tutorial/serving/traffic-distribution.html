<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Traffic Distribution :: Knative Tutorial</title>
    <link rel="canonical" href="https://redhat-developer-demos.github.io/knative-tutorial/knative-tutorial/serving/traffic-distribution.html">
    <link rel="prev" href="basic-fundas.html">
    <link rel="next" href="scaling.html">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img src="../../_/img/NewRHDFullLogo_4-color_white-wordmark.png" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="https://redhat-developer-demos.github.io/knative-tutorial">Knative Tutorial</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://developers.redhat.com/ebooks/" target="_blank">Books</a>
        <a class="navbar-item" href="https://developers.redhat.com/cheatsheets/" target="_blank">Cheat Sheets</a>
        <a class="navbar-item" href="https://developers.redhat.com/events/" target="_blank">Upcoming Events</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/kubernetes-tutorial/" target="_blank">Kubernetes</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/istio-tutorial/" target="_blank">Istio</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/quarkus-tutorial/" target="_blank">Quarkus</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/knative-tutorial/" target="_blank">Knative</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/tekton-tutorial/" target="_blank">Tekton</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="knative-tutorial" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html"></a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../setup/setup.html">Setup</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../setup/setup.html#download-tutorial-sources">Tutorial Sources</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../setup/setup.html#tools">Tutorial Tools</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../setup/kubernetes-cluster.html#kubernetes-cluster">Choose your Kubernetes Cluster</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../setup/minikube.html">Minikube</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../setup/minikube.html#start-minikube">Configure and Start Minikube</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../setup/minikube.html#minikube-deploy-registry">Deploy Registry</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../setup/minikube.html#install-knative-serving">Install Knative Serving</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../setup/minikube.html#install-kourier-ingress-gateway">Install Kourier Ingress Gateway</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../setup/minikube.html#install-ingress-controller">Install Ingress Controller</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../setup/minikube.html#install-knative-eventing">Install Knative Eventing</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../setup/minikube.html#create-tutorial-namespace">Create Tutorial Namespace</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../setup/openshift.html">OpenShift</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Knative Serving</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="knative-client.html">Knative Client</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="knative-client.html#kn-install">Install</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="knative-client.html#kn-ksvc">Knative Service Commands</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="knative-client.html#kn-create-ksvc">Create Knative Service</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="knative-client.html#kn-list-services">List Knative Services</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="knative-client.html#kn-update-ksvc">Update Knative Service</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="knative-client.html#kn-desc-ksvc">Describe Knative Service</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="knative-client.html#kn-delete-ksvc">Delete Knative Service</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="knative-client.html#kn-revisons">Knative Revision Commands</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="knative-client.html#kn-revisions-list">Knative Revision List</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="knative-client.html#kn-revisions-desc">Knative Revision Describe</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="knative-client.html#kn-revisions-delete">Knative Revision Delete</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="knative-client.html#kn-routes">Knative Route Commands</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="knative-client.html#kn-route-list">Knative Revision List</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="basic-fundas.html">Serving</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="basic-fundas.html#basics-prerequisite">Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="basic-fundas.html#basics-build-containers">Build Containers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="basic-fundas.html#basics-deploy-service">Deploy Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="basic-fundas.html#basics-invoke-service">Invoke Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="basic-fundas.html#basics-see-what-you-have-deployed">See What You Have Deployed</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="basic-fundas.html#deploying-new-revision">Deploy a New Revision of a Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="basic-fundas.html#basics-cleanup">Cleanup</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="traffic-distribution.html">Revisions and Traffic Distribution</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#deploy-colors-service">Deploy Colors Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#deploying-new-revision">Deploy New Revision</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#tag-service-revisions">Tagging Revisions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#blue-green">Blue-Green Deployment</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#canary-release">Canary Release</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="scaling.html">Scaling</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="scaling.html#scaling-deploy-service">Deploy Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="scaling.html#scaling-invoke-service">Invoke Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="scaling.html#scaling-scale-to-zero">Scale to Zero</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="scaling.html#scaling-observer-scale-to-zero">Observing Default Scale Down</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="scaling.html#scaling-observer-scale-to-zero-1m">Change Scale-to-Zero Time</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="scaling.html#scaling-reset-to-defaults">Reset to Defaults</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="scaling.html#scaling-auto-scaling">Auto Scaling</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="scaling.html#scaling-autoscaling-deploy-service">Deploy Service</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="scaling.html#scaling-autoscaling-invoke-service">Invoke Service</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="scaling.html#scaling-load-service">Load Service</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="scaling.html#scaling-min-scale">Minimum Scale</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="scaling.html#scaling-deploy-service-minscale">Deploy Service</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="scaling.html#scaling-cleanup">Cleanup</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../eventing/index.html">Knative Eventing</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../eventing/eventing.html#eventing-prerequisite">Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../eventing/eventing.html#eventing-watch-logs">Watching Logs</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../eventing/eventing-src-to-sink.html">Source to Sink</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../eventing/eventing-src-to-sink.html#eventing-source">Event Source</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../eventing/eventing-src-to-sink.html#eventing-sink-service">Sink Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../eventing/eventing-src-to-sink.html#eventing-create-event-source">Create Event Source</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../eventing/eventing-src-to-sink.html#eventing-verify-event-source">Verify</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../eventing/eventing-src-to-sink.html#eventing-see-what-you-have-deployed">See What You Have Deployed</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../eventing/eventing-src-to-sink.html#eventing-cleanup">Cleanup</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../eventing/channel-and-subscribers.html">Channel and Subscribers</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../eventing/channel-and-subscribers.html#eventing-channel">Channel</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../eventing/channel-and-subscribers.html#eventing-create-event-channel">Create Event Channel</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../eventing/channel-and-subscribers.html#eventing-verify-event-channel">Verify</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../eventing/channel-and-subscribers.html#eventing-source">Event Source</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../eventing/channel-and-subscribers.html#eventing-create-event-source">Create Event Source</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../eventing/channel-and-subscribers.html#eventing-verify-event-source">Verify</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../eventing/channel-and-subscribers.html#eventing-subscriber">Event Subscriber</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../eventing/channel-and-subscribers.html#eventing-create-subscriber">Create Event Subscriber</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../eventing/channel-and-subscribers.html#eventing-verify-subscriber">Verify</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../eventing/channel-and-subscribers.html#eventing-see-what-you-have-deployed">See What You Have Deployed</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../eventing/channel-and-subscribers.html#eventing-cleanup">Cleanup</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../eventing/eventing-trigger-broker.html">Brokers and Triggers</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../eventing/eventing-trigger-broker.html#events-triggers-brokers">Events, Triggers and Brokers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../eventing/eventing-trigger-broker.html#broker">Broker</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../eventing/eventing-trigger-broker.html#eventing-service">Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../eventing/eventing-trigger-broker.html#eventing-event-source">Event Source</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../eventing/eventing-trigger-broker.html#eventing-trigger">Trigger</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../eventing/eventing-trigger-broker.html#eventing-trigger-verification">Verification</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../eventing/eventing-trigger-broker.html#eventing-cleanup">Cleanup</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../camelk/index.html">Apache Camel K</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../camelk/setup.html">Setup</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../camelk/setup.html#install-camel-k">Install Apache Camel K </a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../camelk/camel-k-basics.html">Camel K with Knative Serving</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../camelk/camel-k-basics.html#deploy-camel-k-integration">Deploy Camel K integration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../camelk/camel-k-basics.html#deploy-camel-k-kn-integration">Deploy Camel K Knative Integration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../camelk/camel-k-basics.html#camelk-gs-cleanup">Cleanup</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../camelk/camel-k-eventing.html">Camel K with Knative Eventing</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../camelk/camel-k-eventing.html#deploy-camel-k-source">Deploy Knative CamelSource</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../camelk/camel-k-eventing.html#logging-ce-messages">View CloudEvents Messages</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../camelk/camel-k-eventing.html#camel-k-es-sink">CamelSource to Sink</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../camelk/camel-k-eventing.html#camelk-eventing-cleanup">Cleanup</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../advanced/index.html">Advanced</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Knative Eventing</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../advanced/deploy-apache-kafka.html">Deploy Apache Kafka</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../advanced/deploy-apache-kafka.html#create-kafka-topic">Create Topic</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../advanced/deploy-apache-kafka.html#kafka-producer">Run Producer</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../advanced/deploy-apache-kafka.html#kafka-consumer">Run Consumer</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../advanced/eventing-with-kafka.html">Knative Eventing with Apache Kafka</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../advanced/eventing-with-kafka.html#kn-eventing-kafka-source">Deploy KafkaSource</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../advanced/eventing-with-kafka.html#kn-eventing-adv-default-knative-channel">Kafka Knative Channel</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../advanced/eventing-with-kafka.html#kn-eventing-kafka-source-to-sink">Kafka Source to Sink</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../advanced/eventing-with-kafka.html#kn-eventing-kafka-auto-scaling">Auto Scaling with Kafka</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../advanced/eventing-with-kafka.html#kn-kafka-src-cleanup">Cleanup</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">EIP with Apache Camel K</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../advanced/camel-k-cbr.html">Content Based Routing</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../advanced/camel-k-cbr.html#cbr-app-overview">Application Overview</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../advanced/camel-k-cbr.html#label-namespace-for-default-broker">Create Broker</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../advanced/camel-k-cbr.html#camel-k-cbr-data-producer">Deploy Data Producer</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../advanced/camel-k-cbr.html#camel-k-cbr-data-processor">Deploy Data Processor</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../advanced/camel-k-cbr.html#camel-k-cbr-event-subscriber">Deploy Event Subscriber</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../advanced/camel-k-cbr.html#camel-k-cbr-event-filter">Apply Knative Filter</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../advanced/camel-k-cbr.html#verify-e2e">Verify End to End</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../advanced/camel-k-cbr.html#kamel-cbr-cleanup">Cleanup</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Knative Tutorial</a></li>
    <li><a href="index.html">Knative Serving</a></li>
    <li><a href="traffic-distribution.html">Revisions and Traffic Distribution</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/redhat-developer-demos/knative-tutorial/blob/v1.18/documentation/modules/serving/pages/traffic-distribution.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Traffic Distribution</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>At the end of this chapter you will be able to :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Providing custom name to deployment</p>
</li>
<li>
<p>Understanding advanced deployment techniques</p>
</li>
<li>
<p>Apply blue-green deployment pattern</p>
</li>
<li>
<p>Apply Canary Release Deployment pattern</p>
</li>
<li>
<p>Reduce the service visibility</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As you learnt from previous chapter, Knative always routes traffic to the <strong>latest</strong> revision of the service. It is possible to split the traffic amongst the available revisions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="deploy-colors-service"><a class="anchor" href="#deploy-colors-service"></a>Deploy colors service</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To explore the goals of this chapter, we will be using a colors service called <strong>blue-green-canary</strong>.</p>
</div>
<div class="listingblock">
<div class="title"><a href="https://github.com/redhat-developer-demos/knative-tutorial/blob/v1.18/serving/colors-service-blue.yaml">blue</a></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: serving.knative.dev/v1
kind: Service
metadata:
  name: blue-green-canary
spec:
  template:
    spec:
      containers:
        - image: quay.io/rhdevelopers/blue-green-canary
          env:
            - name: BLUE_GREEN_CANARY_COLOR
              value: "#6bbded"
            - name: BLUE_GREEN_CANARY_MESSAGE
              value: "Hello"</code></pre>
</div>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset1_kn"></a>kn</p>
</li>
<li>
<p><a id="tabset1_kubectl"></a>kubectl</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset1_kn">
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kn service create blue-green-canary \
   --image=quay.io/rhdevelopers/blue-green-canary \
   --env BLUE_GREEN_CANARY_COLOR="#6bbded" \
   --env BLUE_GREEN_CANARY_MESSAGE="Hello"</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset1_kubectl">
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl apply -n knativetutorial -f <a href="https://github.com/redhat-developer-demos/knative-tutorial/blob/v1.18/serving/colors-service-blue.yaml">$TUTORIAL_HOME/serving/colors-service-blue.yaml</a></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_invoke_the_service"><a class="anchor" href="#_invoke_the_service"></a>Invoke the Service</h3>
<div class="paragraph">
<p>Get the service URL,</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kn service describe blue-green-canary -o url</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use the URL to open the service in a browser window.If the service was deployed correctly you should see blue background browser page, with greeting as <strong>Hello</strong>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/blue-green-canary-blue.png" alt="blue green canary blue">
</div>
<div class="title">Figure 1. Blue Green Canary::Blue</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="deploying-new-revision"><a class="anchor" href="#deploying-new-revision"></a>Deploy a New Revision of a Service</h2>
<div class="sectionbody">
<div class="sidebarblock">
<div class="content">
<div class="title">Twelve-factor app</div>
<div class="paragraph">
<p><a href="https://12factor.net/">12factor.net</a> defines the twelve-factor app as a methodology for building software-as-a-service apps that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use declarative formats for setup automation, to minimize time and cost for new developers joining the project;</p>
</li>
<li>
<p>Have a clean contract with the underlying operating system, offering maximum portability between execution environments;</p>
</li>
<li>
<p>Are suitable for deployment on modern cloud platforms, obviating the need for servers and systems administration;</p>
</li>
<li>
<p>Minimize divergence between development and production, enabling continuous deployment for maximum agility;</p>
</li>
<li>
<p>And can scale up without significant changes to tooling, architecture, or development practices.</p>
</li>
<li>
<p>The twelve-factor methodology can be applied to apps written in any programming language, and which use any combination of backing services (database, queue, memory cache, etc).</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>In line with <strong>12-Factor</strong> principle, Knative rolls out new deployment whenever the Service <strong>Configuration</strong> changes, and creates immutable version of code and configuration called <strong>revision</strong>. An example of configuration change could for e.g. an update of Service image, a change to environment variables or add liveness/readiness probes.</p>
</div>
<div class="paragraph">
<p>Let us now change the configuration of the service by updating the service environment variable <strong>BLUE_GREEN_CANARY_COLOR</strong> to make the browser display <strong>green</strong> color with greeting text as <strong>Namaste</strong>.</p>
</div>
<div class="listingblock">
<div class="title"><a href="https://github.com/redhat-developer-demos/knative-tutorial/blob/v1.18/serving/colors-service-green.yaml">green</a></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: serving.knative.dev/v1
kind: Service
metadata:
  name: blue-green-canary
spec:
  template:
    spec:
      containers:
        - image: quay.io/rhdevelopers/blue-green-canary
          env:
            - name: BLUE_GREEN_CANARY_COLOR
              value: "#5bbf45"
            - name: BLUE_GREEN_CANARY_MESSAGE
              value: "Namaste"</code></pre>
</div>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset2_kn"></a>kn</p>
</li>
<li>
<p><a id="tabset2_kubectl"></a>kubectl</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset2_kn">
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kn service update blue-green-canary \
   --image=quay.io/rhdevelopers/blue-green-canary \
   --env BLUE_GREEN_CANARY_COLOR="#5bbf45" \
   --env BLUE_GREEN_CANARY_MESSAGE="Namaste"</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset2_kubectl">
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl apply -n knativetutorial -f <a href="https://github.com/redhat-developer-demos/knative-tutorial/blob/v1.18/serving/colors-service-green.yaml">$TUTORIAL_HOME/serving/colors-service-green.yaml</a></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now invoking the service again using the service URL, will show a green color browser page with greeting <strong>Namaste</strong>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/blue-green-canary-green.png" alt="blue green canary green">
</div>
<div class="title">Figure 2. Blue Green Canary::Green</div>
</div>
<div class="sect2">
<h3 id="rev1-basics-show-knative-revisions"><a class="anchor" href="#rev1-basics-show-knative-revisions"></a>revisions</h3>
<div class="paragraph">
<p>Check to ensure you have two revisions of the blue-green-canary service:</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset3_kn"></a>kn</p>
</li>
<li>
<p><a id="tabset3_kubectl"></a>kubectl</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset3_kn">
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kn revision list --namespace knativetutorial</code></pre>
</div>
</div>
<div class="listingblock console-output">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">NAME                        SERVICE             TRAFFIC   TAGS   GENERATION   AGE     CONDITIONS   READY   REASON
blue-green-canary-yzrwq-2   blue-green-canary   100%             2            2m33s   3 OK / 4     True
blue-green-canary-xjygh-1   blue-green-canary                    1            30m     3 OK / 4     True</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset3_kubectl">
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl --namespace knativetutorial get rev \
  --selector=serving.knative.dev/service=blue-green-canary \
  --sort-by="{.metadata.creationTimestamp}"</code></pre>
</div>
</div>
<div class="listingblock console-output">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">NAME                        CONFIG NAME         K8S SERVICE NAME            GENERATION   READY   REASON
blue-green-canary-xjygh-1   blue-green-canary   blue-green-canary-xjygh-1   1            True
blue-green-canary-yzrwq-2   blue-green-canary   blue-green-canary-yzrwq-2   2            True</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="OpenShift"></i>
</td>
<td class="content">
<div class="videoblock">
<div class="content">
<iframe width="640" height="480" src="https://www.youtube.com/embed/KAeDG4j5fr8?rel=0" frameborder="0" allowfullscreen></iframe>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tag-service-revisions"><a class="anchor" href="#tag-service-revisions"></a>Tag Revisions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As you had observed that the Knative service <code>blue-green-canary</code> now has two revisions namely <strong>blue-green-canary-xjygh-1</strong> and <strong>blue-green-canary-yzrwq-2</strong>. As the Revision names are autogenerated it is hard to comprehend to which code/configuration set it corresponds to. To overcome this problem Knative provides <strong>tagging</strong> of revision names that allows one to tag a revision name to a logical human understanable names called <strong>tags</strong>.</p>
</div>
<div class="paragraph">
<p>As our colors service shows different colors on the browser let us tag the revisions with color,</p>
</div>
<div class="paragraph">
<p>List the existing revisions,</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kn revision list -s blue-green-canary</code></pre>
</div>
</div>
<div class="listingblock console-output">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">NAME                        SERVICE             TRAFFIC   TAGS   GENERATION   AGE   CONDITIONS   READY   REASON
blue-green-canary-yzrwq-2   blue-green-canary   100%             2            23m   3 OK / 4     True
blue-green-canary-xjygh-1   blue-green-canary                    1            51m   3 OK / 4     True</code></pre>
</div>
</div>
<div class="paragraph">
<p>When Knative rolls out a new revision, it increments the <code>GENERATION</code> by <strong>1</strong> and then routes <strong>100%</strong> of the <code>TRAFFIC</code> to it, hence we can use the <code>GENERATION</code> or <code>TRAFFIC</code> to identify the latest reivsion.</p>
</div>
<div class="sect2">
<h3 id="_tag_blue"><a class="anchor" href="#_tag_blue"></a>Tag Blue</h3>
<div class="paragraph">
<p>Let us tag <code>blue-green-canary-xjygh-1</code> which shows <strong>blue</strong> browser page with tag name <code>blue</code>.</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kn service update -n knativetutorial blue-green-canary --tag=<mark>blue-green-canary-xjygh-1</mark>=blue</code></pre>
</div>
</div>
<div class="listingblock console-output">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">Updating Service 'blue-green-canary' in namespace 'knativetutorial':

  0.037s The Route is still working to reflect the latest desired specification.
  0.126s Ingress has not yet been reconciled.
  0.162s Waiting for load balancer to be ready
  0.303s Ready to serve.

Service 'blue-green-canary' with latest revision 'blue-green-canary-yzrwq-2' (unchanged) is available at URL:
http://blue-green-canary.knativetutorial.192.168.64.13.nip.io</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tag_green"><a class="anchor" href="#_tag_green"></a>Tag Green</h3>
<div class="paragraph">
<p>Let us tag <code>blue-green-canary-yzrwq-2</code> which shows <strong>green</strong> browser page with tag name <code>green</code>.</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kn service update -n knativetutorial blue-green-canary --tag=<mark>blue-green-canary-yzrwq-2</mark>=green</code></pre>
</div>
</div>
<div class="listingblock console-output">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">Updating Service 'blue-green-canary' in namespace 'knativetutorial':

  0.037s The Route is still working to reflect the latest desired specification.
  0.126s Ingress has not yet been reconciled.
  0.162s Waiting for load balancer to be ready
  0.303s Ready to serve.

Service 'blue-green-canary' with latest revision 'blue-green-canary-yzrwq-2' (unchanged) is available at URL:
http://blue-green-canary.knativetutorial.192.168.64.13.nip.io</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tag_latest"><a class="anchor" href="#_tag_latest"></a>Tag Latest</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Lets tag whatever revision that is latest to be tagged as <strong>latest</strong>.</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kn service update -n knativetutorial blue-green-canary --tag=@latest=latest</code></pre>
</div>
</div>
<div class="listingblock console-output">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">Updating Service 'blue-green-canary' in namespace 'knativetutorial':

  0.037s The Route is still working to reflect the latest desired specification.
  0.126s Ingress has not yet been reconciled.
  0.162s Waiting for load balancer to be ready
  0.303s Ready to serve.

Service 'blue-green-canary' with latest revision 'blue-green-canary-yzrwq-2' (unchanged) is available at URL:
http://blue-green-canary.knativetutorial.192.168.64.13.nip.io</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let us query the Service Revisions again,</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kn revision list -s blue-green-canary</code></pre>
</div>
</div>
<div class="listingblock console-output">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">NAME                        SERVICE             TRAFFIC   TAGS    GENERATION   AGE   CONDITIONS   READY   REASON
blue-green-canary-yzrwq-2   blue-green-canary   100%      <mark>latest,green</mark>   2            29m   3 OK / 4     True
blue-green-canary-xjygh-1   blue-green-canary             <mark>blue</mark>    1            57m   3 OK / 4     True</code></pre>
</div>
</div>
<div class="paragraph">
<p>As <strong>green</strong> happend to be latest revision it has been tagged with name <code>lastest</code> in addition to <code>green</code>.</p>
</div>
<div class="paragraph">
<p>Let us use the tag names for easier identification of the revision and perform traffic distribution amongst them.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="blue-green"><a class="anchor" href="#blue-green"></a>Applying Blue-Green Deployment Pattern</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Knative offers a simple way of switching 100% of the traffic from one Knative service revision (blue) to another newly rolled out revision (green). If the new revision (e.g. green) has erroneous behavior then it is easy to rollback the change.</p>
</div>
<div class="paragraph">
<p>In this exercise you will applying the Blue/Green deployment pattern with the Knative Service called greeter. You have already deployed two <a href="#deploying-revisions">revisions</a> of blue-green-canary identified using the tags  <code>blue</code> and <code>green</code>.</p>
</div>
<div class="paragraph">
<p>With the deployment of <strong>green</strong> revison you noticed that Knative automatically started to routing 100% of the traffic to <code>blue-green-canary-yzrwq-2</code>.</p>
</div>
<div class="paragraph">
<p>Now let us assume, due to a critical bug  we need to roll back <code>green</code> to <code>blue</code>.</p>
</div>
<div class="paragraph">
<p>The following Knative Service YAML is identical to the previously deployed <code>green</code> except that we have added the <em>traffic</em> section to indicate that 100% of the traffic should be routed to <code>blue</code>.</p>
</div>
<div class="paragraph">
<p>Before you rollback the revision, refresh the browser window where you have opened the blue-green-canary service, to make sure it is still showing <strong>green</strong> browser page with greeting <strong>Namaste</strong>.</p>
</div>
<div class="paragraph">
<p>Now apply the update Knative service configuration using the command as shown in following listing:</p>
</div>
<div class="sect2">
<h3 id="_rollback_to_blue"><a class="anchor" href="#_rollback_to_blue"></a>Rollback to blue</h3>
<div class="paragraph">
<p>Route all the traffic of service <code>blue-green-canary</code> to blue revision of the service:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kn service update blue-green-canary --traffic blue=100,green=0,latest=0</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
We use the tag names to identify the revisions
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Let us list all revisions with tags:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kn revision list --namespace knativetutorial</code></pre>
</div>
</div>
<div class="paragraph">
<p>Based on the revision tags that we created earlier, the output should be like:</p>
</div>
<div class="listingblock console-output">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">NAME                        SERVICE             TRAFFIC   TAGS           GENERATION   AGE   CONDITIONS   READY   REASON
blue-green-canary-yzrwq-2   blue-green-canary             latest,green   2            56m   4 OK / 4     True
blue-green-canary-xjygh-1   blue-green-canary   <mark>100%</mark>      <mark>blue</mark>           1            83m   4 OK / 4     True</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let us list the available sub-routes:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl -n knativetutorial get ksvc blue-green-canary -oyaml \
 | yq r - 'status.traffic[*].url'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above command should return you three sub-routes for the main <code>greeter</code> route:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"><a href="http://latest-blue-green-canary.knativetutorial.192.168.64.13.nip.io" class="bare">http://latest-blue-green-canary.knativetutorial.192.168.64.13.nip.io</a> <i class="conum" data-value="1"></i><b>(1)</b>
<a href="http://blue-blue-green-canary.knativetutorial.192.168.64.13.nip.io" class="bare">http://blue-blue-green-canary.knativetutorial.192.168.64.13.nip.io</a> <i class="conum" data-value="2"></i><b>(2)</b>
<a href="http://green-blue-green-canary.knativetutorial.192.168.64.13.nip.io" class="bare">http://green-blue-green-canary.knativetutorial.192.168.64.13.nip.io</a>  <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the sub route for the traffic tag <code>latest</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the sub route for the traffic tag <code>blue</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>the sub route for the traffic tag <code>green</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You will notice that the command does not create any new configuration/revision/deployment as there was no application update (e.g. image tag, env var, etc), but when you call the service, Knative scales up the <code>blue</code> that shows <strong>blue</strong> browser page with greeting <strong>Hello</strong>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/blue-green-canary-blue.png" alt="blue green canary blue">
</div>
<div class="title">Figure 3. Blue Green Canary::Blue</div>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl get pods</code></pre>
</div>
</div>
<div class="listingblock console-output">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">NAME                                     READY   STATUS        RESTARTS   AGE
<mark>blue-green-canary-xjygh-1-deployment-54597d94b9-25x4r</mark>   2/2     Running       0          12s
blue-green-canary-yzrwq-2-deployment-6cb545df65-ktqc2   0/2     Terminating   0          2m</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since <code>blue</code> is the active revision now, the existing <code>green</code> pod is getting terminated as no future requests will be served by it.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As an exercise, flip all the traffic back to <code>green</code> using <code>kn</code> command.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="OpenShift"></i>
</td>
<td class="content">
<div class="videoblock">
<div class="content">
<iframe width="640" height="480" src="https://www.youtube.com/embed/9KlHEwWaeIA?rel=0" frameborder="0" allowfullscreen></iframe>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="canary-release"><a class="anchor" href="#canary-release"></a>Applying Canary Release Pattern</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A Canary release is more effective when you want to reduce the risk of introducing new feature. It allows you a more effective feature-feedback loop before rolling out the change to your entire user base.</p>
</div>
<div class="paragraph">
<p>Knative allows you to split the traffic between revisions in increments as small as 1%.</p>
</div>
<div class="paragraph">
<p>To see this in action, apply the following Knative service definition that will split the traffic 80% to 20% between <code>blue</code> and <code>green</code>.</p>
</div>
<div class="paragraph">
<p>To roll out the greeter canary deployment use the following command:</p>
</div>
<div class="listingblock console-input">
<div class="title">Create greeter canary Deployment</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kn service update blue-green-canary -n knativetutorial \
  --traffic="blue=80" \
  --traffic="green=20"</code></pre>
</div>
</div>
<div class="paragraph">
<p>As in the previous section on <a href="#blue-green">Applying Blue-Green Deployment Pattern</a> deployments, the command will not create any new configuration/revision/deployment. To observe the traffic distribution, open the Service Route URL in your browser window.</p>
</div>
<div class="paragraph">
<p>You will notice the browser alternating betwee green and blue color, with majority of the time staying with blue.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/blue-green-canary.gif" alt="blue green canary">
</div>
</div>
<div class="paragraph">
<p>You should also notice that two pods are running representing both <code>blue</code> and <code>green</code>:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">watch "kubectl get pods -n knativetutorial"</code></pre>
</div>
</div>
<div class="listingblock console-output">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">NAME                                                    READY   STATUS    RESTARTS   AGE
blue-green-canary-xjygh-1-deployment-54597d94b9-q8c57   2/2     Running   0          79s
blue-green-canary-yzrwq-2-deployment-8564bf5b5b-gtvh4   2/2     Running   0          14s</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Challenge"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As a challenge:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Deploy a new revision called "yellow" which will show Yellow Color browser page (Hex for yellow is <code>#f2f25e</code>) and a greeting text <code>Bonjour</code>.</p>
</li>
<li>
<p>Create the tag called yellow, mapping to yellow revision of the service.</p>
</li>
<li>
<p>Update the traffic distribution to be 70% to blue, 20% to green and 10% to yellow.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="OpenShift"></i>
</td>
<td class="content">
<div class="videoblock">
<div class="content">
<iframe width="640" height="480" src="https://www.youtube.com/embed/5cNU6vAAbXQ?rel=0" frameborder="0" allowfullscreen></iframe>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="basics-cleanup"><a class="anchor" href="#basics-cleanup"></a>Cleanup</h2>
<div class="sectionbody">
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kn -n knativetutorial service delete blue-green-canary</code></pre>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="basic-fundas.html">Serving</a></span>
  <span class="next"><a href="scaling.html">Scaling</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../../_/js/vendor/clipboard.js"></script>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
