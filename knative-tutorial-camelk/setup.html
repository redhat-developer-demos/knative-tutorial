<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Knative Tutorial :: Knative Tutorial</title>
    <link rel="canonical" href="https://redhat-developer-demos.github.io/knative-tutorial/knative-tutorial-camelk/setup.html">
    <meta name="generator" content="Antora 2.2.0">
    <link rel="stylesheet" href="../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img src="../_/img/NewRHDFullLogo_4-color_white-wordmark.png" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="https://redhat-developer-demos.github.io/knative-tutorial">Knative Tutorial</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://developers.redhat.com/ebooks/" target="_blank">Books</a>
        <a class="navbar-item" href="https://developers.redhat.com/cheatsheets/" target="_blank">Cheat Sheets</a>
        <a class="navbar-item" href="https://developers.redhat.com/events/" target="_blank">Upcoming Events</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/kubernetes-tutorial/" target="_blank">Kubernetes</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/istio-tutorial/" target="_blank">Istio</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/quarkus-tutorial/" target="_blank">Quarkus</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/knative-tutorial/" target="_blank">Knative</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/tekton-tutorial/" target="_blank">Tekton</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="knative-tutorial-camelk" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html"></a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="setup.html">Setup</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#install-camel-k">Install Camel-K </a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="camel-k-basics.html">Camel-K with Knative Serving</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="camel-k-basics.html#deploy-camel-k-integration">Deploy Camel-K integration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="camel-k-basics.html#deploy-camel-k-kn-integration">Deploy Camel-K Knative Integration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="camel-k-basics.html#camelk-gs-cleanup">Cleanup</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="camel-k-eventing.html">Camel-K with Knative Eventing</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="camel-k-eventing.html#deploy-camel-k-source">Deploy Knative CamelSource</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="camel-k-eventing.html#logging-ce-messages">View CloudEvents Messages</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="camel-k-eventing.html#camel-k-es-sink">CamelSource to Sink</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="camel-k-eventing.html#camelk-eventing-cleanup">Cleanup</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../knative-tutorial/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Knative with Apache Camel-K</a></li>
    <li><a href="setup.html">Setup</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/redhat-developer-demos/knative-tutorial-module-camelk/edit/release/v0.14.x/modules/ROOT/pages/setup.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Knative Tutorial</h1>
<div class="sect1">
<h2 id="camelk-setup"><a class="anchor" href="#camelk-setup"></a>Setup</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="install-camel-k"><a class="anchor" href="#install-camel-k"></a>Install Camel-k</h3>
<div class="paragraph">
<p>Download the latest camel-k release from <a href="https://github.com/apache/camel-k/releases/latest">here</a>. Extract the content and add the binary <code>kamel</code> to the PATH.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As of building this tutorial the latest <strong>kamel</strong> version was <code>1.0.0-nightly.202005130003</code></p>
</div>
</td>
</tr>
</table>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset1_kubernetes"></a>Kubernetes</p>
</li>
<li>
<p><a id="tabset1_openshift"></a>OpenShift</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset1_kubernetes">
<div id="camel-k-k8s-install" class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kamel install --olm=false \
  --maven-repository=https://repository.apache.org/content/repositories/snapshots@id=apache-snapshots@snapshots \
 --wait</code></pre>
</div>
</div>
<div class="paragraph">
<p>As with other installations in this tutorial, this process will take a few minutes for the Camel-K pods to be up and running.  You can monitor the progress of the installation by watching the pods in namespace <code>knativetutorial</code>.</p>
</div>
<div id="camel-k-watch-pods" class="listingblock console-input">
<div class="title">Camel K Pods</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">watch "kubectl -n knativetutorial get pods"</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Camel-k install will take some time, please wait for the successful installation before proceeding to the further sections of this tutorial.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A successful camel-K setup will have the following pods running/completed in <code>knativetutorial</code> namespace:</p>
</div>
<div class="listingblock console-output">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">NAME                                READY   STATUS      RESTARTS   AGE
camel-k-operator-84d7896b68-9mfdv   1/1     Running     0          2m7s</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset1_openshift">
<div class="paragraph">
<p>Camel-K is installed using its <a href="https://operatorhub.io/operator/camel-k">operator</a>.Use the Operator Hub in OpenShift webconsole to install the Camel-K operator.</p>
</div>
<div class="paragraph">
<p>Once the operator is deployed successfully, run the following command to setup <code>Camel-K</code> in the namespace:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kamel install --cluster-setup --skip-operator-setup</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In OpenShift, the <code>kamel install</code> command will not install Camel-K operator in each namespace, rather its done one time at cluster level when installing the Operator.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configure-maven-repo"><a class="anchor" href="#configure-maven-repo"></a>Configure Camel-k to build faster</h3>
<div class="paragraph">
<p>Camel-K uses <a href="https://maven.apache.org">Apache Maven</a> to build the integration kits and its related containers. The Apache Maven settings for Camel K are stored in a ConfigMap <code>camel-k-maven-settings</code> in the knativetutorial namespace. One of the ways to make the build faster is by using a maven repository manager such as <a href="https://www.sonatype.com/nexus-repository-oss">Sonatype Nexus</a>, the repository manager helps in caching the maven artifacts from remote repositories and serves them from local the subsequent times they are asked to be downloaded.</p>
</div>
<div class="paragraph">
<p>Edit the file <code>$TUTORIAL_HOME/install/utils/camel-k-maven-settings.xml</code> to adjust to your maven repository settings:</p>
</div>
<div class="paragraph">
<p>Create the ConfigMap using the command:</p>
</div>
<div id="camel-k-maven-config" class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl create configmap \
  -n knativetutorial my-camel-k-maven-settings \
  --from-file=settings.xml="$TUTORIAL_HOME/install/utils/camel-k-maven-settings.xml"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Install or Update <code>Camel-K</code> and make it use the maven repository settings:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kamel install --force \ <i class="conum" data-value="1"></i><b>(1)</b>
  --maven-settings="configmap:my-camel-k-maven-settings/settings.xml" \
  --wait</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>--force</code> is used to update any existing <code>Camel-K</code> installs to use the new settings</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_deploy_nexus_to_local_cluster_optional"><a class="anchor" href="#_deploy_nexus_to_local_cluster_optional"></a>Deploy Nexus to Local Cluster (Optional)</h3>
<div class="paragraph">
<p>If you don&#8217;t have a <a href="https://www.sonatype.com/download-oss-sonatype" class="ext-link" target="_blank" rel="noopener">Sonatype Nexus Repository</a>, you can deploy one into the cluster using the deployment <code>$TUTORIAL_HOME/install/utils/nexus/app.yaml</code>.</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl apply -n knativetutorial -f $TUTORIAL_HOME/install/utils/nexus.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Wait for the nexus pod to be ready:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">watch kubectl get -n knativetutorial pods</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once nexus is running you should see the following pod in the <code>knativetutorial</code>:</p>
</div>
<div class="listingblock console-output">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">NAME                                READY   STATUS    RESTARTS   AGE
camel-k-operator-65db5d46bb-llc6g   1/1     Running   0          22h
<strong>nexus-5dc54dd879-tlv2g              1/1     Running   0          9m49s</strong></code></pre>
</div>
</div>
<div class="paragraph">
<p>The nexus repository can be opened in your browser using the command:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">minikube -p knativetutorial service -n knativetutorial nexus</code></pre>
</div>
</div>
<div class="paragraph">
<p>You need to use user <code>admin</code> to login. Nexus uses a generated password, to retrieve the generated password run:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">export NEXUS_POD=$(kubectl -n knativetutorial get pods \
  -lapp=nexus -ojsonpath='{.items[0].metadata.name}')
kubectl exec $NEXUS_POD -- cat /nexus-data/admin.password</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will be able to reset it after the first login. You can then <a href="#configure-maven-repo">Configure Camel-k to build faster</a>.</p>
</div>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../_/js/vendor/clipboard.js"></script>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
