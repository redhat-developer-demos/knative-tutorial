<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Untitled :: Knative Tutorial</title>
    <link rel="canonical" href="https://redhat-developer-demos.github.io/knative-tutorial/knative-tutorial-camelk/camel-k-basics.html">
    <meta name="generator" content="Antora 2.2.0">
    <link rel="stylesheet" href="../_/css/site.css">
<link rel="icon" href="../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<script src="https://unpkg.com/clipboard@2/dist/clipboard.min.js"></script>
  </head>
  <body class="article">
<header class="header" role="banner">
  <nav class="navbar">
    <div class="navbar-brand">
      <div class="navbar-item">
        <a href="https://redhat-developer-demos.github.io/knative-tutorial">Knative Tutorial</a>
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
  </nav>
</header>
<div class="main-wrapper">
<div class="navigation-container"  data-component="knative-tutorial-camelk"
  data-version="master" >
  <aside class="navigation">
    <div class="panels">
      <div class="navigation-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">Knative with Apache Camel-K</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="setup.html">Setup</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="setup.html#camelk-prerequisite">Prerequisite</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="setup.html#install-camel-k">Install Camel-K </a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="camel-k-basics.html">Camel-K with Knative Serving</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#camel-k-prerequisite">Prerequisite</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#deploy-camel-k-integration">Deploy Camel-K integration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#deploy-camel-k-kn-integration">Deploy Camel-K Knative Integration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#camelk-gs-cleanup">Cleanup</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="camel-k-eventing.html">Camel-K with Knative Eventing</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="camel-k-eventing.html#camel-k-eve-prerequisite">Prerequisite</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="camel-k-eventing.html#deploy-camel-k-source">Deploy Knative CamelSource</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="camel-k-eventing.html#logging-ce-messages">View CloudEvents Messages</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="camel-k-eventing.html#camel-k-es-sink">CamelSource to Sink</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="camel-k-eventing.html#camelk-eventing-cleanup">Cleanup</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
  <div class="navigation-explore" data-panel="explore">
  <div class="context">
    <!-- Just a place holder to fill in  explorer for each context -->
  </div>
</div>
</div>
  <main class="main">
<div class="toolbar" role="navigation">
  <button class="navigation-toggle"></button>
  <a href="../knative-tutorial/index.html" class="home-link"></a>
  <nav class="crumbs" aria-label="breadcrumbs">
  <ul>
    <li class="crumb"><a href="index.html">Knative with Apache Camel-K</a></li>
    <li class="crumb"><a href="camel-k-basics.html">Camel-K with Knative Serving</a></li>
  </ul>
</nav>
</div>
<article class="doc">
<div class="sect1">
<h2 id="camel-k-basics"><a class="anchor" href="#camel-k-basics"></a>Camel-K Basics</h2>
<div class="sectionbody">
<div class="paragraph">
<p>At the end of this chapter you will be able to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Understand Camel-K deployment</p>
</li>
<li>
<p>How to create Camel-K integration</p>
</li>
<li>
<p>How to run using development mode</p>
</li>
<li>
<p>How to add dependencies to Camel-K</p>
</li>
<li>
<p>How to run your Camel-K integration in serverless mode</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="camel-k-prerequisite"><a class="anchor" href="#camel-k-prerequisite"></a>Prerequisite</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following checks ensure that each chapter exercises are done with the right environment settings.</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset1_minikube"></a>Minikube</p>
</li>
<li>
<p><a id="tabset1_minishift"></a>Minishift</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset1_minikube">
<div class="ulist">
<ul>
<li>
<p>Set your local docker to use minikube docker daemon</p>
</li>
</ul>
</div>
<div id="minikube-set-env" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">eval $(minikube docker-env)</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#minikube-set-env"><i class="fa fa-clipboard"></i></button><br/>
<div class="ulist">
<ul>
<li>
<p>Kubernetes should be v1.12+</p>
</li>
</ul>
</div>
<div id="kubectl-version" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl version</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#kubectl-version"><i class="fa fa-clipboard"></i></button><br/>
</div>
<div class="tab-pane" aria-labelledby="tabset1_minishift">
<div class="ulist">
<ul>
<li>
<p>Set your local docker to use minishift docker daemon</p>
</li>
</ul>
</div>
<div id="minishift-set-env" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">eval $(minishift docker-env)</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#minishift-set-env"><i class="fa fa-clipboard"></i></button><br/>
<div class="ulist">
<ul>
<li>
<p>OpenShift CLI should be v3.11.0+</p>
</li>
</ul>
</div>
<div id="oc-version" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">eval $(minishift oc-env)
oc version</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#oc-version"><i class="fa fa-clipboard"></i></button><br/>
<div class="ulist">
<ul>
<li>
<p>Make sure to be on <code>knativetutorial</code> OpenShift project</p>
</li>
</ul>
</div>
<div id="right-openshift-project" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc project -q</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#right-openshift-project"><i class="fa fa-clipboard"></i></button><br/>
<div class="paragraph">
<p>If you are not on <code>knativetutorial</code> project, then run following command to change to <code>knativetutorial</code> project:</p>
</div>
<div id="change-to-openshift-project" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc project knativetutorial</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#change-to-openshift-project"><i class="fa fa-clipboard"></i></button><br/>
</div>
</div>
</div>
<div class="paragraph">
<p>Navigate to the tutorial chapter&#8217;s folder advanced/camel-k:</p>
</div>
<div id="camelk-repo-nav-folder" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd $TUTORIAL_HOME/advanced/camel-k</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#camelk-repo-nav-folder"><i class="fa fa-clipboard"></i></button><br/>
<div class="sect2">
<h3 id="deploy-camel-k-integration"><a class="anchor" href="#deploy-camel-k-integration"></a>Deploy Camel-K integration</h3>
<div class="paragraph">
<p>Camel-K helps you in writing the Apache Camel integrations using Java, JS, XML and as YAML.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For all the integration exercises, we will be using YAML DSL.</p>
</div>
<div class="paragraph">
<p>Apache Camel YAML DSL is still under active development but using this DSL will give you a consistent resource definition across Kubernetes, Knative and Camel-K</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Let us analyze our first Camel-K integration before running it. A Camel-K integration resource is an array of one flow or multiple route definitions. The following listing shows you simple timer integration with just one route:</p>
</div>
<div class="listingblock">
<div class="title">Camel K integration - greeter</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">- from:
    uri: "timer:tick" <i class="conum" data-value="1"></i><b>(1)</b>
    parameters: <i class="conum" data-value="2"></i><b>(2)</b>
      period: "10s"
    steps: <i class="conum" data-value="3"></i><b>(3)</b>
      - set-body: <i class="conum" data-value="4"></i><b>(4)</b>
          constant: "Welcome to Apache Camel K"
      - set-header: <i class="conum" data-value="5"></i><b>(5)</b>
          name: ContentType
          simple: text/plain
      - transform: <i class="conum" data-value="6"></i><b>(6)</b>
          simple: "${body.toUpperCase()}"
      - to: <i class="conum" data-value="7"></i><b>(7)</b>
          uri: "log:info?multiline=true&amp;showAll=true"</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The Apache Camel producer URI, in this case it is the <a href="https://camel.apache.org/components/latest/timer-component.html">timer</a> component.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>parameters</code> allows to specify the configurable properties of the component. In this case the timer component needs to tick every <code>10</code> seconds.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>steps</code> defines the flow of Camel exchange(IN). Each Camel K integration should have at least one step defined.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Sets the body of the Camel exchange(OUT), a constant value of "Welcome to Apache Camel K"</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>It is possible to set headers as part of the step, this sets the <code>ContentType</code> header with its value <code>text/plain</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>It is possible to apply transformations as part of a step. This applies a simple transformation of converting the exchange OUT body to uppercase.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>In the end you send the processed exchange(OUT) to its desired destination, here we simply log it out.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is possible  have any number of steps as needed for an integration based on your use case. In the later sections of this chapter you will deploy multi-step based integration examples.</p>
</div>
<div class="paragraph">
<p><code>kamel</code> CLI tool is used to deploy the integrations. Run the following command to</p>
</div>
<div id="deploy-integration-dev-mode" class="listingblock">
<div class="title">Deploy the greeter integration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kamel run --dev --dependency 'camel:log' get-started/timed-greeter.yaml</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#deploy-integration-dev-mode"><i class="fa fa-clipboard"></i></button><br/>
<div class="paragraph">
<p>A typical Camel K integration deployment will take approximately 2-5 minutes, as it involves multiple steps such as:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Building an integration kit(camel-k-kit) which builds the container image with all the required Camel modules downloaded and added to classpath within the container image.</p>
</li>
<li>
<p>If using Knative then deploy as a Knative Service</p>
</li>
<li>
<p>Run the container image as a Kubernetes pod and start the Camel context</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Once the integration is built, you sill see the terminal populated with logs from the integration like:</p>
</div>
<div class="listingblock">
<div class="title">timed-greeter logs</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># kamel run --dev --dependency 'camel:log' get-started/timed-greeter.yaml
...
[1] 2020-01-13 03:25:28.548 INFO  [Camel (camel-k) thread #1 - timer://tick] info - Exchange[
[1]   Id: ID-timed-greeter-57b4d49974-vg859-1578885868551-0-13
[1]   ExchangePattern: InOnly
[1]   Properties: {CamelCreatedTimestamp=Mon Jan 13 03:25:28 UTC 2020, CamelExternalRedelivered=false, CamelMessageHistory=[DefaultMessageHistory[routeId=route1, node=setBody1], DefaultMessageHistory[routeId=route1, node=setHeader1], DefaultMessageHistory[routeId=route1, node=transform1], DefaultMessageHistory[routeId=route1, node=to1]], CamelTimerCounter=7, CamelTimerFiredTime=Mon Jan 13 03:25:28 UTC 2020, CamelTimerName=tick, CamelTimerPeriod=10000, CamelToEndpoint=log://info?multiline=true&amp;showAll=true}
[1]   Headers: {ContentType=text/plain, firedTime=Mon Jan 13 03:25:28 UTC 2020}
[1]   BodyType: String
[1]   Body: WELCOME TO APACHE CAMEL K
[1] ]</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you are not using maven repository manager or it takes long time to download maven artifacts, your earlier command <code>kamel run --dev ..</code> will report a failure. In those cases, run the command <code>kamel get</code> to see the status of the integration. Once you see the <code>timed-greeter</code> pod running, then use <code>kamel log timed-greeter</code> to see the logs as shown in the earlier listing.</p>
</div>
<div class="paragraph">
<p>You can use Ctrl+C to stop the running Camel K integration and it automatically terminate its pods. If you had encountered the dev mode failure as described earlier, try to delete the integration using the command <code>kamel delete timed-greeter</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>dev</code> mode allows live reload of code. Update the <code>timed-greeter.yaml</code> body text to be "Hi Camel K rocks!" and observe the automatic reloading of the context and the logs printing the new message.</p>
</div>
</div>
<div class="sect2">
<h3 id="deploy-camel-k-kn-integration"><a class="anchor" href="#deploy-camel-k-kn-integration"></a>Deploy Camel-K Knative Integration</h3>
<div class="paragraph">
<p>Any Camel-K integration can be converted into a serverless service using Knative. For an integration to be deployed as a Knative Service you need to use the Camel-K&#8217;s <code>knative</code> component.</p>
</div>
<div class="paragraph">
<p>The Camel-K Knative component provides two consumers: <code>knative:endpoint</code> and <code>knative:channel</code>. The former is used to deploy the integration as Knative Service, while the later is used to handle events from a Knative Event channel.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Knative endpoints can be either a Camel producer or consumer depending on the context and need.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We wil now deploy a <code>knative:endpoint</code> consumer as part of your integration, that will add the serverless capabilities to your Camel-K integration using Knative.</p>
</div>
<div class="paragraph">
<p>The following listing shows a simple <code>echoer</code> Knative Camel-K integration, that will simply respond to your Knative Service call with same body that you sent into it in uppercase form.  If there is no body received the service will respond with "no body received":</p>
</div>
<div class="listingblock">
<div class="title">Echoer Integration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">- from:
    uri: "knative:endpoint/echoer" <i class="conum" data-value="1"></i><b>(1)</b>
    steps:
      - log:
          message: "Got Message: ${body}"
      - convert-body: "java.lang.String" <i class="conum" data-value="2"></i><b>(2)</b>
      - choice:
          when:
            - simple: "${body} != null &amp;&amp; ${body.length} &gt; 0"
              steps:
                - set-body:
                    simple: "${body.toUpperCase()}"
                - set-header:
                    name: ContentType
                    simple: text/plain
                - log:
                    message: "${body}"
          otherwise:
            steps:
              - set-body:
                  constant: "no body received"
              - set-header:
                  name: ContentType
                  simple: text/plain
              - log:
                  message: "Otherwise::${body}"</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The consumer needs to be a Knative endpoint URI of form <code>knative:endpoint/&lt;your endpoint name&gt;</code>, the name of the Knative service will be the last path segment of the URI, in this case your Knative service will be called <code>echoer</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You will be converting the incoming data (request body) to <code>java.lang.String</code> as that will help you in converting to upper case.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can run this integration as shown in the following listing. If you notice that you are now deploying the integration in production mode i.e without <code>--dev</code> option.</p>
</div>
<div id="camel-k-kn-run" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kamel run --wait --dependency camel:log --dependency camel:bean \
    get-started/echoer.yaml</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#camel-k-kn-run"><i class="fa fa-clipboard"></i></button><br/>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can use <code>stern camel-k</code> to monitor the progress of the builder pod as well as <code>watch kubectl kamel get</code> and monitor the <strong>PHASE</strong> column.  In addition, <code>watch kubectl get ksvc</code> looking at the <strong>READY</strong> column to become True.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Since its the production mode and it takes some time for the integration to come up, you need to watch the integration&#8217;s logs using the command <code>kamel log &lt;integration name&gt;</code> i.e. <code>kamel log echoer</code> and you can get the name of the integration using the command <code>kamel get</code>.</p>
</div>
<div class="paragraph">
<p>In the integration that you had deployed, you had applied the <a href="https://camel.apache.org/manual/latest/choice-eip.html">Choice EIP</a> when processing the exchange body. When the body has content then it simply converts the body to upper case otherwise it returns a canned response of "no body received". In either case, the content type header is set to <code>text/plain</code>.</p>
</div>
<div class="paragraph">
<p>Camel-K defines an <code>integration</code> via Custom Resource Definition (CRD) and you can view those CRDs and the actual <code>integrations</code> via the following commands:</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset2_kubectl"></a>kubectl</p>
</li>
<li>
<p><a id="tabset2_oc"></a>oc</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset2_kubectl">
<div id="camel-k-crds" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl api-resources --api-group=camel.apache.org</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#camel-k-crds"><i class="fa fa-clipboard"></i></button><br/>
</div>
<div class="tab-pane" aria-labelledby="tabset2_oc">
<div id="oc-camel-k-crds" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc api-resources --api-group=camel.apache.org</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#oc-camel-k-crds"><i class="fa fa-clipboard"></i></button><br/>
</div>
</div>
</div>
<div class="paragraph">
<p>The command above shows the following output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">NAME                   SHORTNAMES   APIGROUP           NAMESPACED   KIND
builds                              camel.apache.org   true         Build
camelcatalogs          cc           camel.apache.org   true         CamelCatalog
integrationkits        ik           camel.apache.org   true         IntegrationKit
integrationplatforms   ip           camel.apache.org   true         IntegrationPlatform
integrations           it           camel.apache.org   true         Integration</code></pre>
</div>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset3_kubectl"></a>kubectl</p>
</li>
<li>
<p><a id="tabset3_oc"></a>oc</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset3_kubectl">
<div id="camel-k-list-int" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">watch kubectl -n knativetutorial get integrations</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#camel-k-list-int"><i class="fa fa-clipboard"></i></button><br/>
</div>
<div class="tab-pane" aria-labelledby="tabset3_oc">
<div id="oc-camel-k-list-int" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">watch oc -n knativetutorial get integrations</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#oc-camel-k-list-int"><i class="fa fa-clipboard"></i></button><br/>
</div>
</div>
</div>
<div class="paragraph">
<p>A successful integration deployment should show the following output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">NAME              PHASE     KIT                        REPLICAS
echoer            Running   kit-bodug9d83u4bmr3uh8jg   1</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the integration is started, you can check the Knative service using the command:</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset4_kubectl"></a>kubectl</p>
</li>
<li>
<p><a id="tabset4_oc"></a>oc</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset4_kubectl">
<div id="camel-k-chk-kn-svc" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl -n knativetutorial get ksvc echoer</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#camel-k-chk-kn-svc"><i class="fa fa-clipboard"></i></button><br/>
</div>
<div class="tab-pane" aria-labelledby="tabset4_oc">
<div id="oc-camel-k-chk-kn-svc" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc -n knativetutorial get ksvc echoer</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#oc-camel-k-chk-kn-svc"><i class="fa fa-clipboard"></i></button><br/>
</div>
</div>
</div>
<div class="paragraph">
<p>When the service is in a ready state use the call script <code>$TUTORIAL/bin/call.sh</code> with parameter <code>echoer</code> and a request body of "Hello World":</p>
</div>
<div id="call-echoer-with-param" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$TUTORIAL_HOME/bin/call.sh echoer 'Hello World'</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#call-echoer-with-param"><i class="fa fa-clipboard"></i></button><br/>
<div id="call-echoer-without-param" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$TUTORIAL_HOME/bin/call.sh echoer ''</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#call-echoer-without-param"><i class="fa fa-clipboard"></i></button><br/>
<div class="paragraph">
<p>The invocation of a Knative Camel-K Integration is a bit different than previous Knative test calls.  The Knative Camel-K integration service is expecting a POST where the input data is part of the request body.  Therefore, you need to a few different elements to construct the invocation, the following snippet from <code>$TUTORIAL_HOME/bin/call.sh</code> shows how a Knative service call is constructed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ <strong>NODE_PORT=$(kubectl get svc istio-ingressgateway -n istio-system \
-o 'jsonpath={.spec.ports[?(@.port==80)].nodePort}')</strong> <i class="conum" data-value="1"></i><b>(1)</b>
$ <strong>IP_ADDRESS="$(minikube ip):$NODE_PORT"</strong> <i class="conum" data-value="2"></i><b>(2)</b>
$ <strong>HOST_HEADER="Host:echoer.knativetutorial.example.com"</strong> <i class="conum" data-value="3"></i><b>(3)</b>
$ <strong>curl -X POST -H $HOST_HEADER -d "Hello World" $IP_ADDRESS</strong> <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>All Knative traffic should flow through the Istio Ingress gateway and NodePort is the easiest solution on minikube</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Minikube, which is running as a VM on your local machine, provides a local IP address (e.g. 192.168.99.100)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The host header can be determined by running <code>kubectl get ksvc echoer</code>, just make sure to <strong>remove</strong> the "http://" prefix</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>curl with a POST</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Explore the <code>kamel</code> tool via its help option of <code>kamel --help</code> to see the list of available commands and their respective options.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="cleanup"><a class="anchor" href="#cleanup"></a>Cleanup</h3>
<div id="camelk-gs-cleanup" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kamel delete echoer</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#camelk-gs-cleanup"><i class="fa fa-clipboard"></i></button><br/>
</div>
</div>
</div>
</article>
  </main>
</div>
<footer role="contentinfo">
  <div class="region region-rhd-footer">
    <div id="block-rhdfooter" class="rhd-footer">
      <nav class="rhd-footer-nav" aria-label="Secondary Navigation" role="navigation">
  <ul class="rhd-menu">
    <li class="menu-item menu-item--expanded">
      <h3 class="section-toggle">GitHub</h3>
      <ul class="rhd-menu">
        <li class="menu-item">
          <a href="https://github.com/redhat-developer-demos/knative-tutorial" title="Knative Tutorial">Knative
            Tutorial</a>
        </li>
        <li class="menu-item">
          <a href="https://github.com/redhat-developer-demos/knative-tutorial/issues" title="Issue Tracker">Issue
            Tracker</a>
        </li>
        <li class="menu-item">
          <a href="https://github.com/openshift-cloud-functions/Documentation"
            title="OpenShift Cloud Functions">OpenShift Cloud Functions</a>
        </li>
      </ul>
    </li>
  </ul>
</nav>
      <div class="rhd-footer-sidebar">
        <p class="rhd-footer-sidebar-title">Red Hat Developer</p>
        <p class="rhd-footer-sidebar-subtitle">Build here. Go anywhere.</p>
        <p class="rhd-footer-sidebar-content">
          We serve the builders. The problem solvers who create careers with
          code.<br /><br /><a href="https://developer.redhat.com/register">Join us</a>
          if you’re a developer, software engineer, web designer, front-end
          designer, UX designer, computer scientist, architect, tester,
          product manager, project manager or team lead.
        </p>
        <ul class="rhd-footer-sidebar-social">
          <li>
            <a href="https://www.youtube.com/channel/UC7noUdfWp-ukXUlAsJnSm-Q" target="_blank"
              rel="noopener noreferrer"><svg class="svg-inline--fa fa-youtube fa-w-18" aria-hidden="true"
                data-prefix="fab" data-icon="youtube" role="img" xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 576 512" data-fa-i2svg="">
                <path fill="currentColor"
                  d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z">
                </path>
              </svg><!-- <i class="fab fa-youtube"></i> --></a>
          </li>
          <li>
            <a href="https://www.facebook.com/RedHatDeveloperProgram" target="_blank" rel="noopener noreferrer"><svg
                class="svg-inline--fa fa-facebook fa-w-14" aria-hidden="true" data-prefix="fab" data-icon="facebook"
                role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg="">
                <path fill="currentColor"
                  d="M448 56.7v398.5c0 13.7-11.1 24.7-24.7 24.7H309.1V306.5h58.2l8.7-67.6h-67v-43.2c0-19.6 5.4-32.9 33.5-32.9h35.8v-60.5c-6.2-.8-27.4-2.7-52.2-2.7-51.6 0-87 31.5-87 89.4v49.9h-58.4v67.6h58.4V480H24.7C11.1 480 0 468.9 0 455.3V56.7C0 43.1 11.1 32 24.7 32h398.5c13.7 0 24.8 11.1 24.8 24.7z">
                </path>
              </svg><!-- <i class="fab fa-facebook"> </i> --></a>
          </li>
          <li>
            <a href="https://twitter.com/rhdevelopers" target="_blank" rel="noopener noreferrer"><svg
                class="svg-inline--fa fa-twitter fa-w-16" aria-hidden="true" data-prefix="fab" data-icon="twitter"
                role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg="">
                <path fill="currentColor"
                  d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z">
                </path>
              </svg><!-- <i class="fab fa-twitter"> </i> --></a>
          </li>
          <li>
            <a href="https://github.com/redhat-developer" target="_blank" rel="noopener noreferrer"><svg
                class="svg-inline--fa fa-github fa-w-16" aria-hidden="true" data-prefix="fab" data-icon="github"
                role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" data-fa-i2svg="">
                <path fill="currentColor"
                  d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z">
                </path>
              </svg><!-- <i class="fab fa-github"> </i> --></a>
          </li>
        </ul>
        <a class="rhd-footer-sidebar-signup" href="https://developers.redhat.com/register">Sign me up ▸</a>
      </div>
    </div>
  </div>
</footer>
<script src="../_/js/site.js"></script>
<script src="../_/js/vendor/highlight.js"></script>
<script>hljs.initHighlighting()</script>
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
  integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
  integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
  integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
  </body>
</html>
