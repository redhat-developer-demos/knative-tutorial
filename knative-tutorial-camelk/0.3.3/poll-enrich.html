<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome to Knative Tutorial :: Knative Tutorial</title>
    <link rel="canonical" href="https://redhat-developer-demos.github.io/knative-tutorial/knative-tutorial-camelk/0.3.3/poll-enrich.html">
    <meta name="generator" content="Antora 2.0.1">
    <link rel="stylesheet" href="../../_/css/site.css">
<link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<script src="https://unpkg.com/clipboard@2/dist/clipboard.min.js"></script>
  </head>
  <body class="article">
<header class="header" role="banner">
  <nav class="navbar">
    <div class="navbar-brand">
      <div class="navbar-item">
        <a href="https://redhat-developer-demos.github.io/knative-tutorial">Knative Tutorial</a>
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
  </nav>
</header>
<div class="main-wrapper">
<div class="navigation-container"  data-component="knative-tutorial-camelk"
  data-version="0.3.3" >
  <aside class="navigation">
    <div class="panels">
      <div class="navigation-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">Eventing with Apache Camel</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="setup.html">1.Setup</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="setup.html#camelk-prerequisite">Prerequisite</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="setup.html#camelk-download-sources">Download Demo Sources</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="setup.html#camelk-install-minio-s3">Install minio s3 Server</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="setup.html#minio-aws-cli-configure">Configure AWS cli</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="setup.html#install-camel-k">Install Camel-K </a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="setup.html#configure-local-registry">2.Configure Local Container Registry</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="common-prereqs.html">2.Prerequisite</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="getting-started.html">3.Message Filter</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="getting-started.html#gs-overview">Demo Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="getting-started.html#gs-deployment">Deployment</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="getting-started.html#gs-make-s3-data-bucket">Create data s3 bucket</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="getting-started.html#gs-make-s3-top-bucket">Create top s3 bucket</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="getting-started.html#gs-cartoon-messages-mover">Deploy Camel Route</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="getting-started.html#gs-watch-logs">Watching Logs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="getting-started.html#gs-test-cartoon-messages-mover">Testing Route</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="getting-started.html#gs-test-data">Upload Test Data</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="getting-started.html#gs-invoke-service">Invoke service</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="getting-started.html#gs-cleanup">Cleanup</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="poll-enrich.html">4.Poll Enrich</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#pe-overview">Demo Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="#pe-deployment">Deployment</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#pe-make-s3-data-bucket">Create data s3 bucket</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#pe-make-s3-top-bucket">Create top s3 bucket</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#pe-cartoon-messages-downloader">Deploy Camel Route</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#pe-watch-logs">Watching Logs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="#pe-test-cartoon-messages-downloader">Testing Route</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#pe-test-data">Upload Test Data</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#pe-invoke-service">Invoke service</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#pe-cleanup">Cleanup</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="content-based-router.html">5.Content Based Router</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="content-based-router.html#cbr-overview">Demo Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="content-based-router.html#cbr-deployment">Deployment</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="content-based-router.html#cbr-make-s3-data-bucket">Create data s3 bucket</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="content-based-router.html#cbr-create-channels">Create Knative  Channels</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="content-based-router.html#cbr-deploy-routes">Deploy Routes</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="content-based-router.html#cbr-comedy-genre-handler">Comedy Genre Handler</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="content-based-router.html#cbr-others-genre-handler">Others Genre Handler</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="content-based-router.html#cbr-cartoon-genre-router">Cartoon Genre Router</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="content-based-router.html#cbr-see-what-you-have-deployed">See what you have deployed </a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="content-based-router.html#cbr-watch-logs">Watching Logs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="content-based-router.html#cbr-test-cartoon-genre-router">Testing Route</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="content-based-router.html#cbr-test-data">Upload Test Data</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="content-based-router.html#cbr-invoke-service">Invoke service</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="content-based-router.html#cbr-cleanup">Cleanup</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
  <div class="navigation-explore" data-panel="explore">
  <div class="context">
    <!-- Just a place holder to fill in  explorer for each context -->
  </div>
</div>
</div>
  <main class="main">
<div class="toolbar" role="navigation">
  <button class="navigation-toggle"></button>
  <a href="../../knative-tutorial/0.7.x/index.html" class="home-link"></a>
  <nav class="crumbs" aria-label="breadcrumbs">
  <ul>
    <li class="crumb"><a href="index.html">Eventing with Apache Camel</a></li>
    <li class="crumb"><a href="poll-enrich.html">4.Poll Enrich</a></li>
  </ul>
</nav>
</div>
<article class="doc">
<h1>Welcome to Knative Tutorial</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>In this chapter we will use Knative + Camel-k to deploy a simple route that will download a file from s3 and send the file content as response to the Knative serving call.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="pe-overview"><a class="anchor" href="#pe-overview"></a>Enterprise Integration Pattern</h2>
<div class="sectionbody">
<div class="sidebarblock">
<div class="content">
<div class="title">Poll Enrich</div>
<div class="paragraph">
<p>Camel comes with flavor pollEnrich as a choice of content enricher in the DSL. The other one is enrich <code>pollEnrich</code> uses a Polling Consumer to obtain the additional data. It is usually used for Event Message messaging, for instance to read a file or download a FTP file.</p>
</div>
<div class="paragraph text-right">
<p>Source: <a href="https://github.com/apache/camel/blob/master/core/camel-core/src/main/docs/eips/pollEnrich-eip.adoc" class="bare">https://github.com/apache/camel/blob/master/core/camel-core/src/main/docs/eips/pollEnrich-eip.adoc</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_demo_overview"><a class="anchor" href="#_demo_overview"></a>Demo Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The demo has an Apache Camel route configured as <strong>knative serving</strong> endpoint, that gets activated once it receives an event i.e. s3 object (xml file) name. Upon activation it starts a Apache Camel route that applies <strong>Poll Enricher EIP</strong> to download the file from and send the content as the response to the Knative serving service call</p>
</div>
<div class="paragraph">
<p>The following diagram shows the pictorial overview of the demo:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/poll-enrich-demo.png" alt="Poll Enricher">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="pe-deployment"><a class="anchor" href="#pe-deployment"></a>Deployment</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can skip this step and move to <a href="#pe-cartoon-messages-downloader">deploy cartoon message downloader</a> if you have already completed the <a href="getting-started.html" class="page">previous section</a>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="pe-make-s3-data-bucket"><a class="anchor" href="#pe-make-s3-data-bucket"></a>Make s3 <strong>data</strong> bucket</h3>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset1_minikube"></a>minikube</p>
</li>
<li>
<p><a id="tabset1_minishift"></a>minishift</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset1_minikube">
<div id="minio-s3url-mkb-kubectl" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">S3_URL=$(minikube service -n knativetutorial minio-server --url)</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#minio-s3url-mkb-kubectl"><i class="fa fa-clipboard"></i></button><br/>
</div>
<div class="tab-pane" aria-labelledby="tabset1_minishift">
<div id="minio-s3url-mkb-oc" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">S3_URL=$(minishift service -n knativetutorial minio-server --url)</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#minio-s3url-mkb-oc"><i class="fa fa-clipboard"></i></button><br/>
</div>
</div>
</div>
<div class="paragraph">
<p>For this demos we will be using a s3 bucket called <code>data</code>, run the following command to create the bucket in s3:</p>
</div>
<div id="mkb-aws-s3-set-eip" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">aws --endpoint-url $S3_URL s3 mb s3://data</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#mkb-aws-s3-set-eip"><i class="fa fa-clipboard"></i></button><br/>
<div class="paragraph">
<p>Verify the created bucket by listing the s3 storage, running the following command:</p>
</div>
<div id="lsdata-aws-s3-ls" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">aws --endpoint-url $S3_URL s3 ls s3://data</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#lsdata-aws-s3-ls"><i class="fa fa-clipboard"></i></button><br/>
<div class="paragraph">
<p>For more information on how to use aws cli with minio server is available <a href="https://docs.minio.io/docs/aws-cli-with-minio.html">here</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can also create the bucket via the minio <a href="setup.html#minio-webconsole" class="page">web console</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="pe-cartoon-messages-downloader"><a class="anchor" href="#pe-cartoon-messages-downloader"></a>Deploy Cartoon Messages Downloader</h3>
<div class="paragraph">
<p>Navigate to camel-k demo sources folder:</p>
</div>
<div id="camelk-nav-to-quickstart-1" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd $TUTORIAL_HOME/advanced/camel-k/quickstart</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#camelk-nav-to-quickstart-1"><i class="fa fa-clipboard"></i></button><br/>
<div id="camelk-kamel-deploy-int" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kamel run \
 --property 's3EndpointUrl=http://minio-server' \
 --property 'minioAccessKey=demoaccesskey' \
 --property 'minioSecretKey=demosecretkey' \
 <a href="https://github.com/redhat-developer-demos/knative-tutorial-camelk/blob/release/0.5/quickstart/src/main/java/CartoonMessagesDownloader.java">src/main/java/CartoonMessagesDownloader.java</a></code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#camelk-kamel-deploy-int"><i class="fa fa-clipboard"></i></button><br/>
<div class="paragraph">
<p>You can check the deployed integration context:</p>
</div>
<div id="camelk-kamel-int-get" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kamel get</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#camelk-kamel-int-get"><i class="fa fa-clipboard"></i></button><br/>
<div class="paragraph">
<p>Running the above command will return something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">NAME                    PHASE                   CONTEXT
cartoon-messages-downloader  Building Context        ctx-bhvn6lcba0587gdq5jbg</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="pe-watch-logs"><a class="anchor" href="#pe-watch-logs"></a>Watching Logs</h3>
<div class="paragraph">
<p>Since a Cron job source is used in this section of the tutorial, it would emit events every minute. We can watch the logs of the service to see the messages delivered.</p>
</div>
<div class="paragraph">
<p>The logs could be watched using the command:</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset2_kubectl"></a>kubectl</p>
</li>
<li>
<p><a id="tabset2_oc"></a>oc</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset2_kubectl">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl logs -n knativetutorial -f &lt;pod-name&gt; -c user-container</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset2_oc">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc logs -n knativetutorial -f &lt;pod-name&gt; -c user-container</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Using stern with the command <code>stern  -n knativetutorial cartoon-messages-downloader</code>, to filter the logs further add <code>-c user-container</code> to the stern command.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">stern -n knativetutorial -c user-container cartoon-messages-downloader</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="pe-test-cartoon-messages-downloader"><a class="anchor" href="#pe-test-cartoon-messages-downloader"></a>Test the Route</h3>
<div class="sect3">
<h4 id="pe-test-data"><a class="anchor" href="#pe-test-data"></a>Upload test data</h4>
<div class="paragraph">
<p>Navigate to the <code>quickstart</code> folder:</p>
</div>
<div id="camelk-nav-to-quickstart" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd $TUTORIAL_HOME/advanced/camel-k/quickstart</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#camelk-nav-to-quickstart"><i class="fa fa-clipboard"></i></button><br/>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset3_minikube"></a>minikube</p>
</li>
<li>
<p><a id="tabset3_minishift"></a>minishift</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset3_minikube">
<div id="minio-s3url-testupdata-kubectl" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">S3_URL=$(minikube service -n knativetutorial minio-server --url)</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#minio-s3url-testupdata-kubectl"><i class="fa fa-clipboard"></i></button><br/>
</div>
<div class="tab-pane" aria-labelledby="tabset3_minishift">
<div id="minio-s3url-testupdata-oc" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">S3_URL=$(minishift service -n knativetutorial minio-server --url)</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#minio-s3url-testupdata-oc"><i class="fa fa-clipboard"></i></button><br/>
</div>
</div>
</div>
<div class="paragraph">
<p>Upload XML file called <code>message1.xml</code> to s3 bucket called <code>data</code>,</p>
</div>
<div id="upmsgxml-aws-s3-upload-file" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">aws --endpoint-url $S3_URL s3 cp <a href="https://github.com/redhat-developer-demos/knative-tutorial-camelk/blob/release/0.5/quickstart/data/message1.xml">data/message1.xml</a>  s3://data</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#upmsgxml-aws-s3-upload-file"><i class="fa fa-clipboard"></i></button><br/>
<div class="paragraph">
<p>Upload a text file called <code>hello.txt</code> to s3 bucket called <code>data</code>,</p>
</div>
<div id="upmsgtxt-aws-s3-upload-file" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">aws --endpoint-url $S3_URL s3 cp <a href="https://github.com/redhat-developer-demos/knative-tutorial-camelk/blob/release/0.5/quickstart/data/hello.txt">data/hello.txt</a>  s3://data</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#upmsgtxt-aws-s3-upload-file"><i class="fa fa-clipboard"></i></button><br/>
<div class="paragraph">
<p>Verify if the XML and text files were uploaded to the  s3 bucket:</p>
</div>
<div id="lsdata2-aws-s3-ls" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">aws --endpoint-url $S3_URL s3 ls s3://data</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#lsdata2-aws-s3-ls"><i class="fa fa-clipboard"></i></button><br/>
</div>
<div class="sect3">
<h4 id="pe-invoke-service"><a class="anchor" href="#pe-invoke-service"></a>Invoke service</h4>
<div class="paragraph">
<p>Invoke the service by passing a header <code>fileName</code> with value <code>message1.xml</code>, this <code>fileName</code> header value will be used by Camel route to download the file from s3 and return it as the response.</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset4_kubectl"></a>kubectl</p>
</li>
<li>
<p><a id="tabset4_oc"></a>oc</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset4_kubectl">
<div id="pe-is-kubectl-svc-gateway-env" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">IP_ADDRESS="$(minikube ip):$(kubectl get svc istio-ingressgateway --namespace istio-system --output 'jsonpath={.spec.ports[?(@.port==80)].nodePort}')"</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#pe-is-kubectl-svc-gateway-env"><i class="fa fa-clipboard"></i></button><br/>
</div>
<div class="tab-pane" aria-labelledby="tabset4_oc">
<div id="pe-is-oc-svc-gateway-env" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">IP_ADDRESS="$(minishift ip):$(oc get svc istio-ingressgateway --namespace istio-system --output 'jsonpath={.spec.ports[?(@.port==80)].nodePort}')"</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#pe-is-oc-svc-gateway-env"><i class="fa fa-clipboard"></i></button><br/>
</div>
</div>
</div>
<div class="paragraph">
<p>We need to know the knative service <code>cartoon-messages-downloader</code> domain name that needs to be passed as <strong>Host</strong> header, we will query and and set that value in an environment variable called <code>SVC_URL</code>:</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset5_kubectl"></a>kubectl</p>
</li>
<li>
<p><a id="tabset5_oc"></a>oc</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset5_kubectl">
<div id="camelk-pe-is-svc-by-k8s" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">SVC_URL=`kubectl -n knativetutorial get ksvc cartoon-messages-downloader -ojsonpath='{.status.domain}'`</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#camelk-pe-is-svc-by-k8s"><i class="fa fa-clipboard"></i></button><br/>
</div>
<div class="tab-pane" aria-labelledby="tabset5_oc">
<div id="camelk-pe-is-svc-by-oc" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">SVC_URL=`oc  -n knativetutorial get ksvc cartoon-messages-downloader -ojsonpath='{.status.domain}'`</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#camelk-pe-is-svc-by-oc"><i class="fa fa-clipboard"></i></button><br/>
</div>
</div>
</div>
<div id="camelk-message1" class="listingblock xml-call-svc">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -v -H "Host:${SVC_URL}" -H 'fileName: message1.xml' $IP_ADDRESS</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#camelk-message1.xml-call-svc"><i class="fa fa-clipboard"></i></button><br/>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The event simulation above will be removed once the CamelSource event source is available with Knative Eventing.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>On success which is usually HTTP 200, with response having the content of the downloaded file in this case it will be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;cartoon title="TomAndJerry"&gt;
  &lt;productionHouse&gt;MGM&lt;/productionHouse&gt;
  &lt;country&gt;US&lt;/country&gt;
  &lt;genre&gt;comedy&lt;/genre&gt;
&lt;/cartoon&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When the <code>cartoon-messages-downloader</code> has been scaled to zero; when giving a new request it will try to scale up, it will not be able to serve the request until the pod is up, during such time you might get HTTP 502 Bad Gateway errors, give some more time for the pod to come up before issuing the request again.</p>
</div>
<div class="paragraph">
<p>Right now camel-k does not add Liveliness and Readiness Probes which can help avoid this issue. There is a open <a href="https://github.com/apache/camel-k/issues/525">issue</a> which is fixed and will be part of 0.3.1 release.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="pe-cleanup"><a class="anchor" href="#pe-cleanup"></a>Cleanup</h2>
<div class="sectionbody">
<div id="camelk-cleanup" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kamel delete cartoon-messages-downloader -n knativetutorial</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#camelk-cleanup"><i class="fa fa-clipboard"></i></button><br/>
</div>
</div>
</article>
  </main>
</div>
<footer role="contentinfo">
  <div class="region region-rhd-footer">
    <div id="block-rhdfooter" class="rhd-footer">
      <nav class="rhd-footer-nav" aria-label="Secondary Navigation" role="navigation">
  <ul class="rhd-menu">
    <li class="menu-item menu-item--expanded">
      <h3 class="section-toggle">GitHub</h3>
      <ul class="rhd-menu">
        <li class="menu-item">
          <a href="https://github.com/redhat-developer-demos/knative-tutorial" title="Knative Tutorial">Knative
            Tutorial</a>
        </li>
        <li class="menu-item">
          <a href="https://github.com/redhat-developer-demos/knative-tutorial/issues" title="Issue Tracker">Issue
            Tracker</a>
        </li>
         <li class="menu-item">
          <a href="https://github.com/openshift-cloud-functions/Documentation" title="Issue Tracker">OpenShift Cloud Functions</a>
        </li>
      </ul>
    </li>
  </ul>
</nav>      <div class="rhd-footer-sidebar">
        <p class="rhd-footer-sidebar-title">Red Hat Developer</p>
        <p class="rhd-footer-sidebar-subtitle">Build here. Go anywhere.</p>
        <p class="rhd-footer-sidebar-content">
          We serve the builders. The problem solvers who create careers with
          code.<br /><br /><a href="https://developer.redhat.com/register">Join us</a>
          if you’re a developer, software engineer, web designer, front-end
          designer, UX designer, computer scientist, architect, tester,
          product manager, project manager or team lead.
        </p>
        <ul class="rhd-footer-sidebar-social">
          <li>
            <a href="https://www.youtube.com/channel/UC7noUdfWp-ukXUlAsJnSm-Q" target="_blank"
              rel="noopener noreferrer"><svg class="svg-inline--fa fa-youtube fa-w-18" aria-hidden="true"
                data-prefix="fab" data-icon="youtube" role="img" xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 576 512" data-fa-i2svg="">
                <path fill="currentColor"
                  d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z">
                </path>
              </svg><!-- <i class="fab fa-youtube"></i> --></a>
          </li>
          <li>
            <a href="https://www.facebook.com/RedHatDeveloperProgram" target="_blank" rel="noopener noreferrer"><svg
                class="svg-inline--fa fa-facebook fa-w-14" aria-hidden="true" data-prefix="fab" data-icon="facebook"
                role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg="">
                <path fill="currentColor"
                  d="M448 56.7v398.5c0 13.7-11.1 24.7-24.7 24.7H309.1V306.5h58.2l8.7-67.6h-67v-43.2c0-19.6 5.4-32.9 33.5-32.9h35.8v-60.5c-6.2-.8-27.4-2.7-52.2-2.7-51.6 0-87 31.5-87 89.4v49.9h-58.4v67.6h58.4V480H24.7C11.1 480 0 468.9 0 455.3V56.7C0 43.1 11.1 32 24.7 32h398.5c13.7 0 24.8 11.1 24.8 24.7z">
                </path>
              </svg><!-- <i class="fab fa-facebook"> </i> --></a>
          </li>
          <li>
            <a href="https://twitter.com/rhdevelopers" target="_blank" rel="noopener noreferrer"><svg
                class="svg-inline--fa fa-twitter fa-w-16" aria-hidden="true" data-prefix="fab" data-icon="twitter"
                role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg="">
                <path fill="currentColor"
                  d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z">
                </path>
              </svg><!-- <i class="fab fa-twitter"> </i> --></a>
          </li>
          <li>
            <a href="https://github.com/redhat-developer" target="_blank" rel="noopener noreferrer"><svg
                class="svg-inline--fa fa-github fa-w-16" aria-hidden="true" data-prefix="fab" data-icon="github"
                role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" data-fa-i2svg="">
                <path fill="currentColor"
                  d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z">
                </path>
              </svg><!-- <i class="fab fa-github"> </i> --></a>
          </li>
        </ul>
        <a class="rhd-footer-sidebar-signup" href="https://developers.redhat.com/register">Sign me up ▸</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../_/js/site.js"></script>
<script src="../../_/js/vendor/highlight.js"></script>
<script>hljs.initHighlighting()</script>
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
  integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
  integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
  integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
  </body>
</html>
